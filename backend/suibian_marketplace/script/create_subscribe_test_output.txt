jiayi@LAPTOP-SESSTBMF:/mnt/c/Users/User/Documents/buidl/devmatch/suibian/backend/suibian_marketplace/script$ node create_subscribe_test.ts
(node:2466) ExperimentalWarning: Type Stripping is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
üöÄ Starting contract interaction tests...

üí∞ Initial Balances:
Creator (0x91d6de6ad4363ec6947bd621aedd2e0ded77cbd1b8607a46e237ebfd082697f5): 1.5466 SUI
User (0x39a36b6dbc603558147a3e7520de6e0a76e6bff28f37a6d5fdd1b7015f01f2be): 1.8454 SUI
Unauthorized User (0xc98a19675d297a2a73298d63920155f45e6cee099ec6255609dfcf2f2ecd38cf): 2.2295 SUI
TEE Wallet (0xa125b591b0feb5f6f1843b54422831c61a9427531c7c8aab91d6053048a5b092): 0.1500 SUI

üìù Test 1: Creator registering agent...
Creator address: 0x91d6de6ad4363ec6947bd621aedd2e0ded77cbd1b8607a46e237ebfd082697f5
Creator balance before creating agent: 1.5466 SUI
Signing and executing transaction...
Transaction digest: Fg12eiNAZzkhyTU2Jiyv5fCBWoDq6fywVW6DYU6boq2P
üîç All object changes:
  - mutated: 0xa99c44b3d13d39ef026252f2dafa1280c289826d7a8d874499e3515a9e892ed9 (0x2::coin::Coin<0x2::sui::SUI>)
  - created: 0xa89fe6075811877bf6ac56a37ef43827ea7f50ad3521c0ef46ff0df40373f730 (0x57443c6e8e396f4d99f5c6aa152e9e6ecbbf91cbc2cd14c04741130ab7106001::agent_registry::TradingAgent)
  - deleted: 0xf1197c2b224ec2668a8a4e494632aaa6d7368e8465c439b846cbe05dc6f4a457 (0x2::coin::Coin<0x2::sui::SUI>)
‚úÖ Agent object created: 0xa89fe6075811877bf6ac56a37ef43827ea7f50ad3521c0ef46ff0df40373f730
üìã Agent object type: 0x57443c6e8e396f4d99f5c6aa152e9e6ecbbf91cbc2cd14c04741130ab7106001::agent_registry::TradingAgent
‚úÖ Agent created successfully with ID: 0xa89fe6075811877bf6ac56a37ef43827ea7f50ad3521c0ef46ff0df40373f730
üí∞ Balances after agent creation:
‚è≥ Waiting for balance updates to propagate...
Creator (0x91d6de6ad4363ec6947bd621aedd2e0ded77cbd1b8607a46e237ebfd082697f5): 1.5436 SUI
User (0x39a36b6dbc603558147a3e7520de6e0a76e6bff28f37a6d5fdd1b7015f01f2be): 1.8454 SUI
Unauthorized User (0xc98a19675d297a2a73298d63920155f45e6cee099ec6255609dfcf2f2ecd38cf): 2.2295 SUI
TEE Wallet (0xa125b591b0feb5f6f1843b54422831c61a9427531c7c8aab91d6053048a5b092): 0.1500 SUI

üë§ Test 2: User subscribing to agent...
User address: 0x39a36b6dbc603558147a3e7520de6e0a76e6bff28f37a6d5fdd1b7015f01f2be
üéØ Attempting to subscribe to agent: 0xa89fe6075811877bf6ac56a37ef43827ea7f50ad3521c0ef46ff0df40373f730
‚è≥ Waiting for agent object to be available...
‚úÖ Agent object verified: 0xa89fe6075811877bf6ac56a37ef43827ea7f50ad3521c0ef46ff0df40373f730
üìã Agent object type: 0x57443c6e8e396f4d99f5c6aa152e9e6ecbbf91cbc2cd14c04741130ab7106001::agent_registry::TradingAgent
User balance before subscription: 1.8454 SUI
üîß Transaction details:
  - Agent ID: 0xa89fe6075811877bf6ac56a37ef43827ea7f50ad3521c0ef46ff0df40373f730
  - SubscriptionManager ID: 0x8c637cccc86c28b2c0aac50f839e397dbdd15576977a8d52c9387183eea71219
  - Payment amount: 0.01 SUI (10_000_000 MIST)
Signing and executing subscription transaction...
Transaction digest: FF1rMWXEneA71JRDWXHLwhzXShrhWNCmnRKNZz5AnRLQ
Subscription object created: 0x4844db0589efab827eccc2dc1d8431b240ca9e4cc3a6de741ebbcd4d81fa996d
‚úÖ User subscribed successfully with ID: 0x4844db0589efab827eccc2dc1d8431b240ca9e4cc3a6de741ebbcd4d81fa996d
üí∞ Balances after subscription:
‚è≥ Waiting for balance updates to propagate...
Creator (0x91d6de6ad4363ec6947bd621aedd2e0ded77cbd1b8607a46e237ebfd082697f5): 1.5536 SUI
User (0x39a36b6dbc603558147a3e7520de6e0a76e6bff28f37a6d5fdd1b7015f01f2be): 1.8288 SUI
Unauthorized User (0xc98a19675d297a2a73298d63920155f45e6cee099ec6255609dfcf2f2ecd38cf): 2.2295 SUI
TEE Wallet (0xa125b591b0feb5f6f1843b54422831c61a9427531c7c8aab91d6053048a5b092): 0.1500 SUI

üí∞ Test 3: User depositing trading funds...
User depositing trading funds...
User balance before deposit: 1.8288 SUI
Signing and executing deposit transaction...
Transaction digest: A6gVKcdERrViQzRg2T6Fw65cWGDGhkF2GgBHJVpgA5j8
‚úÖ FundsDeposited event: {
  agent_id: '0xa89fe6075811877bf6ac56a37ef43827ea7f50ad3521c0ef46ff0df40373f730',
  amount: '50000000',
  subscriber: '0x39a36b6dbc603558147a3e7520de6e0a76e6bff28f37a6d5fdd1b7015f01f2be',
  tee_wallet_address: '0xa125b591b0feb5f6f1843b54422831c61a9427531c7c8aab91d6053048a5b092',
  timestamp: '1754428903180'
}
Balance changes: [
  {
    owner: {
      AddressOwner: '0x39a36b6dbc603558147a3e7520de6e0a76e6bff28f37a6d5fdd1b7015f01f2be'
    },
    coinType: '0x2::sui::SUI',
    amount: '-52019312'
  },
  {
    owner: {
      AddressOwner: '0xa125b591b0feb5f6f1843b54422831c61a9427531c7c8aab91d6053048a5b092'
    },
    coinType: '0x2::sui::SUI',
    amount: '50000000'
  }
]
‚úÖ Trading funds deposited successfully!
‚è≥ Waiting for balance updates to propagate...
üí∞ Balances after deposit:
Creator (0x91d6de6ad4363ec6947bd621aedd2e0ded77cbd1b8607a46e237ebfd082697f5): 1.5536 SUI
User (0x39a36b6dbc603558147a3e7520de6e0a76e6bff28f37a6d5fdd1b7015f01f2be): 1.7768 SUI
Unauthorized User (0xc98a19675d297a2a73298d63920155f45e6cee099ec6255609dfcf2f2ecd38cf): 2.2295 SUI
TEE Wallet (0xa125b591b0feb5f6f1843b54422831c61a9427531c7c8aab91d6053048a5b092): 0.2000 SUI

üö´ Test 4: Unauthorized user attempting to deposit (should fail)...
üö´ Unauthorized user address: 0xc98a19675d297a2a73298d63920155f45e6cee099ec6255609dfcf2f2ecd38cf
Unauthorized user balance: 2.2295 SUI
üîç Attempting to deposit using someone else's subscription (should fail)...
üö´ Attempting deposit with unauthorized user (should fail)...
  - Agent ID: 0xa89fe6075811877bf6ac56a37ef43827ea7f50ad3521c0ef46ff0df40373f730
  - SubscriptionManager ID: 0x8c637cccc86c28b2c0aac50f839e397dbdd15576977a8d52c9387183eea71219
  - Subscription ID: 0x4844db0589efab827eccc2dc1d8431b240ca9e4cc3a6de741ebbcd4d81fa996d (belongs to authorized user)
  - Deposit amount: 0.05 SUI
üö´ Signing and executing unauthorized deposit transaction (should fail)...
‚úÖ SUCCESS: Unauthorized deposit correctly failed!
üîí Transaction aborted: MoveAbort(MoveLocation { module: ModuleId { address: 57443c6e8e396f4d99f5c6aa152e9e6ecbbf91cbc2cd14c04741130ab7106001, name: Identifier("subscription_manager") }, function: 2, instruction: 24, function_name: Some("deposit_trading_funds") }, 6) in command 1
Transaction digest: BjF737Hxq5Bg6XZKwaqDSjUivReVqWKbtGhqjWUngfeq
‚ÑπÔ∏è Transaction failed with Move abort (access control working)
‚è≥ Waiting for balance updates to propagate...
üí∞ Final balances:
Creator (0x91d6de6ad4363ec6947bd621aedd2e0ded77cbd1b8607a46e237ebfd082697f5): 1.5536 SUI
User (0x39a36b6dbc603558147a3e7520de6e0a76e6bff28f37a6d5fdd1b7015f01f2be): 1.7768 SUI
Unauthorized User (0xc98a19675d297a2a73298d63920155f45e6cee099ec6255609dfcf2f2ecd38cf): 2.2285 SUI
TEE Wallet (0xa125b591b0feb5f6f1843b54422831c61a9427531c7c8aab91d6053048a5b092): 0.2000 SUI